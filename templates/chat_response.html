<div class="message-container flex flex-col gap-1 mb-6 animate-fade-in {% if sender == 'user' %}items-end{% else %}items-start{% endif %}">
    <!-- Bubble -->
    <div class="max-w-[92%] md:max-w-[85%] neo-card p-2 md:p-3 {% if sender == 'user' %}bg-[#3c3836]{% else %}bg-[#32302f]{% endif %}">
        {% if message %}
        <div class="markdown-content text-[#ebdbb2] text-[15px]" _="on load renderMessage(me)">{{ message }}</div>
        {% endif %}

        {% if files %}
        <div class="mt-2 flex flex-wrap gap-2">
            {% for file in files %}
            {% if file.type.startswith('image/') %}
            <div class="border border-[#504945] p-1 bg-[#282828] overflow-hidden">
                <img src="{{ file.url }}" class="max-h-64 object-contain" alt="Attached Image">
            </div>
            {% else %}
            <div class="flex items-center gap-2 bg-[#282828] border border-[#504945] p-2">
                <span class="material-symbols-rounded text-lg text-[#a89984]">description</span>
                <span class="text-[10px] font-mono font-medium text-[#ebdbb2] truncate max-w-[120px]">{{ file.name }}</span>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <!-- Message Actions (Moved outside) -->
    <div class="message-actions px-1 {% if sender == 'user' %}flex-row-reverse{% endif %}">
        {% if sender == 'user' %}
        <button class="action-btn" title="Edit">
            <span class="material-symbols-rounded text-base">edit_note</span>
        </button>
        <button class="action-btn" title="Copy" data-message="{{ message }}"
            _="on click copyMessage(me, my.getAttribute('data-message'))">
            <span class="material-symbols-rounded text-base">content_copy</span>
        </button>
        {% else %}
        <button class="action-btn" title="Copy" data-message="{{ message }}"
            _="on click copyMessage(me, my.getAttribute('data-message'))">
            <span class="material-symbols-rounded text-base">content_copy</span>
        </button>
        <button class="action-btn" title="Regenerate">
            <span class="material-symbols-rounded text-base">refresh</span>
        </button>
        <button class="action-btn" title="Helpful" _="on click toggle .text-[#b8bb26]">
            <span class="material-symbols-rounded text-base">thumb_up</span>
        </button>
        <button class="action-btn" title="Not Helpful" _="on click toggle .text-[#fb4934]">
            <span class="material-symbols-rounded text-base">thumb_down</span>
        </button>
        {% endif %}
    </div>
</div>
